# 下書き

情報科学科 小松, 多田, 吉田です。よろしくお願いします。  

はじめに目次です。  
- はじめに
- 前提条件
- 問題提起・目標
- 信号と新システムのメリット・デメリット
- システムについて
- 制作したシステム
- 検証 1回目
- 検証 2回目
- 結果・考察
- 結論


## はじめに
私たちは未来の都市における自動運転をテーマに、
- `情報科` は交差点での一元制御
- `電子分野` は機体自体の制御,
- `電気分野` はワイヤレス給電、
- `機械分野` は機体自体を、
- `都市環境分野` は街の設計

を担当しました。

## 前提条件
前提条件です。  
街は完全に歩車分離がされていて、車も全て自動運転化されている未来を想定しています。  
今回は住宅街の片側一車線の道路を想定して制作しました。  


## 問題提起・目標
現在の自動運転ではカメラを主体として使用していますがそこには問題があると考えました。  
カメラでは気候により視界が悪くなったり、大型トラックや曲がり角など、視認出来ない部分があります。  
また、現在の交差点は他に車がない場合でも止まらなければならないなど柔軟性に掛けていて、完全自動化された世界では効率的では無いと考えました。  

目標は、全ての車を一元管理し、停止する時間を限りなく減らし効率的に目的地に到着させることです  


## システムについて
今回使用した言語はPython3.8 で、  
データベースはsqlite  
通信手段としてsocket通信  
ライブラリは主に  
- socket  
- conccurent.futures  
- sqlite3

を使用します。  


`REQUEST この前の動画`  
今回のシステムは次の動画のようになっています。  
初めに交差点にはこのようにタグが配置されています。1つ目のタグを通るとサーバーに接続したと報告されます。
サーバー側ではデータベースに接続情報が登録され、このデータを元に交差点に進入できるかの判断をし、進入の可否が車側に返されます。  
交差点通過後は通過報告をし、この交差点での通信を終了します。  

進入の可否は待機中の車と進入中の車を順番に比較します。
判断する条件は以下のようになっています
`REQUEST それぞれの図`  
自分: 待機中の車  
相手: 進入中の車  
> 拒否: 自分の待機しているレーンに進入不可の車がある
> 許可: 自分と相手の来る方が同じ
> 拒否: 自分の行き先と相手の行き先が同じ
> 許可: 自分が直進する
> 自分が直進のとき
> - 拒否: 相手が自分の左側から来る
> - 拒否: 相手の行き先が自分の左側
> 自分が右折のとき
> - 拒否: 相手が左から来て前に行く
> - 拒否: 相手が前から来て左に行く
> - 拒否: 相手が右から来て手前に行く

`REQUEST それぞれ図`  
これを実装するには車の来る方向,進行方向を判別する必要があります。
東西南北と左折,直進,右折で表現した場合 `自分が直進で、相手が自分の左側から来る` かを判断だけで
- 自分が直進で、自分が`北`で相手が`東`
- 自分が直進で、自分が`東`で相手が`南`
- 自分が直進で、自分が`南`で相手が`西`
- 自分が直進で、自分が`西`で相手が`北`

`REQUEST 動画でわかりやすく`  
と判断手順が増えてしまいます。ここで、**北:0, 東:1 ,南:2, 西:3**、**左折:0 直進:1 右折:2**とすることにより
- `自分の行き先` == `1` and `自分の来る方 + 1` == `相手の来る方`  
と、簡潔に表すことができました。


## それぞれのメリット・デメリット
信号機のメリットは交通整備が容易で、使用者にわかりやすい仕組みであることに対し、デメリットは非混雑時の無駄な一時停止が挙げられます。  
私たちが提案する新システムは、交差点の状況によって柔軟に進入の可否が判断されるので無駄な一時停止が減ります。  
ただし、タグ検知では広い範囲をカバーすることができないのでそれに対する対処が必要となり、道路に埋め込む場合は整備点検が難しいとおもいます。  
`TODO なんか違う`  


## 制作したシステム
`動画` はじめにsocket通信で車側のesp32と通信するプログラムを制作しました。クライアント側は仮となっています。  
実際に動作させて検証するつもりでしたが、機械分野班が間に合いそうになかったのでシミュレーターを制作し、検証することにしました。


## 一回目の検証
### 検証内容について
シミュレーターは信号と新システム2つを制作しました。  

信号は現在のものを再現し、新システムは先ほどの動画ものです。  
新システム2つ目はこれを同時に進入できるように改善したものです。これらをnew1、new2と呼ぶことにします。

### 検証方法
交差点単体に着目し、ランダムな方向からランダムな方向へ移動する車を5分間でどれだけ処理できたかを比較します。  

### 検証結果
![1-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1751094130&format=image)
![1-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1814756461&format=image)

グラフからnew1は同時進入できない都合上、処理数が一定となってしまいました。
しかし、new2の方は車の間隔が短いときに、信号に勝る効率を出すことができましたが次第に重なっていきました。

> また、車の間隔が広いときは信号とnew2はあまり変わりませんが、待機数が限りなく少ないためともに問題なく捌き切っていることがわかります。

この結果より、同時に進入できるかがいかに影響するかがわかりました。
交差点単体では良い結果が出ましたがより現実に近づけるため、マップ全体として検証しました。  


## 二回目の検証
### システム変更点
システムの変更点として
- 交差点単体ではなく、碁盤の目状のマップとし、
- ランダムな交差点から交差点へ最短経路で移動します。
- 最短経路探索を効率的に行うために Astarアルゴリズム を使用しました。

### 検証方法
12x12 の碁盤の目状のマップで、ランダムな交差点から交差点へ移動させます。  
これを5分間で信号とnew2がどれだけ処理できたかを比較します。

### 検証結果
20回実行し、処理数と待機数それぞれの平均をグラフにした結果、以下のようになりました。  
![2-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=522272234&format=image)  
![2-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1762092698&format=image)  


## 結果・考察
全体的に、信号に比べて改善後は処理数が多く、待機数が少ない、理想的な状況となりました。
特に車が多いとき(300ms/台)は差が顕著にでていました。
また、待機数のグラフより、信号の場合は混雑度に関わらず一定数待機する必要がありますが、改善後はあまり待機する必要がなくなりました。 


## 結論
シミュレートした結果、思い通りのシステムを制作することができました。  
しかし、あくまでも理想環境なので実際に走らせてみる必要があると思いました。  
また、今回はほぼ碁盤の目状のマップで検証したため、構造をより現実的にしてデータをとる必要あると思いました。

今回の研究が、自動運転化社会への一助となればと思います。  
`TODO もっといい感じに`
