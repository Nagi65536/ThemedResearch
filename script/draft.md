# 下書き

情報科学科の小松, 多田, 吉田です。よろしくお願いします。  

はじめに目次です。  
- はじめに
- 前提条件
- 問題提起・目標
- システムについて
- 検証 1回目
- 検証 2回目
- 結論・感想


## はじめに
完全な自動運転について研究しようとしたところ、情報科だけでは実現が難しいと思い5分野で協力することにしました。
最終的に`未来の都市における自動運転`をテーマに、  
`REQUEST 各分野の写真など`  
- `情報科` は交差点での一元制御、
- `電子分野` は機体の制御、
- `電気分野` はワイヤレス給電、
- `機械分野` は機体の設計を、
- `都市環境分野` は街の設計

を担当することにしました。  


## 前提条件
前提条件です。  
街は完全に歩車分離がされていて、車も全て自動運転化されている未来を想定しています。  
今回は住宅街の片側一車線の道路を想定して制作しました。  


## 問題提起・目標
現在の自動運転ではカメラを主体として使用していますが、気候により視界が悪くなるなど、認識しづらい場合があります。  
また、信号は非混雑時にも停止する場合があり、柔軟性に掛けていて、効率的では無いと考えました。  
なので私たちが提案する新システムではタグを用いて、無駄な一時停止を減らすことを目標としました。  


## システムについて
`REQUEST この前の動画`  
提案する新システムは交差点に動画のようにタグが配置されていて、1つ目のタグを通るとサーバーに接続したと報告されます。  
サーバー側ではこのデータを元に交差点に進入できるかの判断をし、この結果が車側に返されます。  
交差点通過後は車から通過報告をし、この交差点での通信を終了します。  

進入の可否は待機中の車と進入中の車を順番に比較します。  
判断する条件は以下のようになっています。  
`REQUEST それぞれの図`  
自分: 待機中の車  
相手: 進入中の車  
> 拒否: 自分の待機しているレーンに進入不可の車がある  
> 
> 許可: 自分と相手の来る方が同じ  
> 
> 拒否: 自分の行き先と相手の行き先が同じ  
>  
> 自分が直進のとき
> - 拒否: 相手が自分の左側から来る  
> - 拒否: 相手が自分の左側へ行く  
> 
> 自分が右折のとき
> - 拒否: 相手が左から来て前に行く
> - 拒否: 相手が前から来て左に行く
> - 許可: 相手が右から来て手前に行く

`REQUEST それぞれ図`  
これを実装するには車の来る方角,進行方向を判別する必要があります。  
自分が直進する場合の判断の一例を見てみると、  
東西南北と左折,直進,右折で表現した場合、  
`自分から見て左側から相手が来る` かを判断するだけで  
東西南北それぞれ4パターンを判断する必要があり、判断基準が増えてしまいます。  
> - 自分が`北`にいて、相手が`東`から来る場合
> - 自分が`東`にいて、相手が`南`から来る場合
> - 自分が`南`にいて、相手が`西`から来る場合
> - 自分が`西`にいて、相手が`北`から来る場合

`REQUEST アニメーションでわかりやすく`  
ここで`北を0, 東を1, 2, 3` `左折を1, 直進2, 右折3`とすることにより、処理を効率化することができました。  
> - `相手の来る方` == `自分の来る方 + 1`  

はじめに、Python3.8を使用し、socket通信で車側のesp32と通信するプログラムを制作しました。  
今回、他の分野と合わせるのが難しく集合ができなかったので、  
シミュレーターを制作し、検証することにしました。  


## 検証 1回目
### 検証内容について
シミュレーターは信号と新システム2つを制作しました。  

信号は現在のものを再現し、新システムの1つ目は来た車から1台ずつ進入するようにしたもので、  
2つ目は先ほどの動画のように同時に進入できるようにしたものです。  
これらをnew1、new2と呼ぶことにします。  

### 検証方法
交差点単体に着目し、ランダムな方角から方角へ移動する車を5分間の処理数と待機数で比較します。  

### 検証結果
こちらが結果をグラフ化したものです。  
![1-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1751094130&format=image)  
![1-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1814756461&format=image)  

グラフからnew1は同時進入できないため、処理数が制限され一定となってしまいました。  
それに対しnew2は混雑時は信号に勝っています。  
次第に等しくなっていますが、待機数が限りなく少ないため共に捌き切れていると考えられます。  

交差点単体では、同時進入の重要さが分かったことなど良い結果が得られましたが、  
より現実に近づけるため、マップ全体として検証しました。  


## 検証 2回目
### システム変更点・検証方法
`REQUEST 碁盤の目状(12x12)のマップにランダムな位置から位置へ`   
変更点として、交差点単体ではなく、およそ碁盤の目状のマップとし、ランダムな交差点から交差点へ移動します。  
経路探索を効率的に行うために `Astarアルゴリズム` を使用します。  
信号とnew2の5分間の処理数と待機数で比較します。  
また、交差点が混雑していた場合はそこを回避する`new2'` `信号'`も比較します。  


### 検証結果
こちらもグラフ化したところ次のようになりました。  
![2-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=522272234&format=image)  
![2-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1762092698&format=image)  

`REQUEST グラフの説明部分にアニメーション`  
全体的に、信号に比べて改善後は処理数が多く待機数が少ない理想的な状況で、特に混雑時は差が顕著に出ていました。  
これは交差点単体での遅延は少なくても経路全体とすると大きくなってしまっているからだと考えられます。  
また、待機数のグラフより、信号は混雑度に関わらず一定数待機する必要がありますが、new2はあまり待機する必要がなくなったことが分かります。  
回避の有無の面ではあまり差がないため混雑により回避できる経路がなく余計な処理が増えたと思われます。  


## 結論・感想
シミュレートした結果、目標通りのシステムだと分かりました。  
しかし、あくまでも理想環境なので実際に走らせてみたり、Y字路や一方通行など、現実的な構造にしてデータをとる必要があると考えます。  

また、チーム全体では意見の相違や仕組みの干渉がありましたが、別のアプローチを模索することで解決でき、  
情報科内ではPythonとGitHubを用いることによりモジュールごとに役割分担をし効率よく開発できました。  
この経験を今後のチーム開発に活かしたいと思います。  

情報科が担当していた交差点の一元制御はシミュレート段階は完成したので、今後は各チームの成果を結集して1つのものにしたいと思います。  
fin
