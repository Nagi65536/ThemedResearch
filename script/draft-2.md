# 下書き

## トップ
続いて情報科学科です。

## 問題提起・目標
`TODO`  
提案する新システムではサーバー側で処理する必要があり、情報科はこれを制作します。  


## システムについて
### 制作物
socket通信で車側と通信するプログラムを制作し、他の分野と合わせる前に、
システムの有効性を検証するためにシミュレータを制作しました。  

### Python について
使用した言語は `Python3.8` です。  
処理は遅いですが、習得がC言語などに比較し容易で、チーム開発する上で扱いやすいためPythonを選びました。  

使用したライブラリは以下の通りです。  
- socket
- sqlite3
- conccurent.futures

`socket` はサーバーと車で通信するためのもの  
`sqlite3` は sqlite というデータベースを操作する  
`conccurent.futures` はマルチスレッドという同時処理をおこなうため  
のライブラリです。

### Astar について
今回のシミュレーションではある交差点から交差点への最短経路を求める必要があるため
`Astarアルゴリズム` を使用しました。

最短経路探索には基本となる `ダイクストラ法` があり、
これは隣接する近い交差点から走査するものです。  
ただし、ゴールとは関係ない方向にも走査するため無駄が多いです。

Astar は直線距離も計算し、ゴール側に寄って走査するため効率よく探索できます。


### 新システムについて
新システムは交差点にタグが配置されていて、1つ目のタグを通るとサーバーに接続報告されます。  
サーバーでは交差点に進入できるかの判断をし、この結果が車側に返されます。  
交差点通過後は車から通過報告をし、この交差点での通信を終了します。  

判断する条件は以下のようになっています。  
自分: 待機中の車  
相手: 進入中の車  
> 拒否: 自分の待機しているレーンに進入不可の車がある  
> 
> 許可: 自分と相手の来る方が同じ  
> 
> 拒否: 自分の行き先と相手の行き先が同じ  
>  
> 自分が直進のとき
> - 拒否: 相手が自分の左側から来る  
> - 拒否: 相手が自分の左側へ行く  
> 
> 自分が右折のとき
> - 拒否: 相手が左から来て前に行く
> - 拒否: 相手が前から来て左に行く
> - 許可: 相手が右から来て手前に行く

これを実装するには車の来る方角,進行方向を判別する必要があります。  
自分が直進する場合の一例を見てみると、  
`自分から見て左側から相手が来る` かを判断するだけで  
東西南北それぞれ4パターンあり、判断基準が増えてしまいます。  
> - 自分が`北`にいて、相手が`東`から来る場合
> - 自分が`東`にいて、相手が`南`から来る場合
> - 自分が`南`にいて、相手が`西`から来る場合
> - 自分が`西`にいて、相手が`北`から来る場合

ここで`北を0, 東を1, 2, 3` `左折を1, 直進2, 右折3`とすることにより、処理を効率化することができました。  
> - `相手の来る方` == `自分の来る方 + 1`  


具体的な例をあげて考えてみましょう。  
`TODO`  

## 検証 1回目
### 検証内容について
続いて検証の内容と結果です。  
シミュレーターは信号と新システム2つを制作しました。  

新システムの1つ目は来た車から1台ずつ進入するようにしたもので、  
2つ目はこれを同時に進入できるようにしたものです。  
これらをnew1、new2と呼ぶことにします。  

交差点単体に着目でランダムな方角から方角へ移動する車を5分間の処理数と待機数で比較します。  


### 検証結果
こちらが結果をグラフ化したものです。  
![1-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1751094130&format=image)  
![1-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1814756461&format=image)  

new1は同時進入できなく制限されるため、一定となっています。  
それに対しnew2の混雑時は信号に勝っています。  
次第に等しくなっていますが、待機数が限りなく少ないため共に車を捌き切れていると分かります。  

より現実に近づけるため、次はマップ全体として検証しました。  


## 検証 2回目
### システム変更点・検証方法
変更点として、 12x12 のおよそ碁盤の目状のマップでランダムな交差点から交差点へと移動します。  
経路探索を効率的に行うために `Astarアルゴリズム` を使用します。  
信号とnew2の5分間の処理数と待機数で比較します。  
また、交差点が混雑していた場合はそこを回避するものも比較します。  


### 検証結果
こちらも同様にグラフ化しました。  
![2-処理数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=522272234&format=image)  
![2-待機数](https://docs.google.com/spreadsheets/d/e/2PACX-1vSDcloY71481hB0FpkomezlnNjGZpPEFegFVnGm2JX5h_pkD8_AO-UcSNwicodauZi7aXvQntKbFgBz/pubchart?oid=1762092698&format=image)  

new2は信号より処理数が多く待機数が少ない理想的な状況で、特に混雑時は差が顕著に出ていました。  
これは交差点単体での遅延は少なくても経路全体とすると大きくなってしまっているからだと考えられます。  
また、信号は混雑度に関わらず一定数待機する必要がありますが、new2はあまり待機する必要がなくなったことが分かります。  
しかし、信号もnew2も回避なしの方がよいため、混雑により回避できる経路がなく余計な処理が増えたと思われます。  


## 情報科の結論
シミュレートしてみた結果、目標通りのシステムだと分かりました。  
Y字路の追加など、より現実的な構造にしてデータをとる必要があると考えます。  


## チームの結論
チーム全体としてそれぞれいい結果となりました。  
今後は各分野の成果を結集し、改良を重ねていきたいと思います。


以上です。ご静聴ありがとうございました。  
fin
